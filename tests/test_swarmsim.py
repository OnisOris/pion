import numpy as np

from swarm_server.swarmsim import SwarmSim, create_objects_Point_yaw


class TestSwarmSim:
    def test_create_swarmsim(self):
        number_of_objects = 16
        swarmsim = SwarmSim(
            create_objects_Point_yaw(
                int(np.sqrt(number_of_objects)), [-5, 5], [-5, 5]
            ),
            logger=False,
        )
        t_speed = np.ones((number_of_objects, 4))
        swarmsim.t_speed = t_speed
        swarmsim.start_simulation_for(steps=10)
        np.set_printoptions(precision=6, suppress=True, linewidth=200)
        states = swarmsim.get_states()
        test_states = np.array(
            [
                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                [
                    -4.9995,
                    -4.9995,
                    0.0005,
                    0.09999999999999999,
                    0.09999999999999999,
                    0.09999999999999999,
                ],
                [-1.6665166666666664, -4.99985, 0.00015, 0.03, 0.03, 0.03],
                [1.666816666666667, -4.99985, 0.00015, 0.03, 0.03, 0.03],
                [5.00015, -4.99985, 0.00015, 0.03, 0.03, 0.03],
                [-4.99985, -1.6665166666666664, 0.00015, 0.03, 0.03, 0.03],
                [
                    -1.6665166666666664,
                    -1.6665166666666664,
                    0.00015,
                    0.03,
                    0.03,
                    0.03,
                ],
                [
                    1.666816666666667,
                    -1.6665166666666664,
                    0.00015,
                    0.03,
                    0.03,
                    0.03,
                ],
                [5.00015, -1.6665166666666664, 0.00015, 0.03, 0.03, 0.03],
                [-4.99985, 1.666816666666667, 0.00015, 0.03, 0.03, 0.03],
                [
                    -1.6665166666666664,
                    1.666816666666667,
                    0.00015,
                    0.03,
                    0.03,
                    0.03,
                ],
                [
                    1.666816666666667,
                    1.666816666666667,
                    0.00015,
                    0.03,
                    0.03,
                    0.03,
                ],
                [5.00015, 1.666816666666667, 0.00015, 0.03, 0.03, 0.03],
                [-4.99985, 5.00015, 0.00015, 0.03, 0.03, 0.03],
                [-1.6665166666666664, 5.00015, 0.00015, 0.03, 0.03, 0.03],
                [1.666816666666667, 5.00015, 0.00015, 0.03, 0.03, 0.03],
                [
                    5.0005804849999995,
                    5.0005804849999995,
                    0.0005804849999999999,
                    0.056096999999999994,
                    0.056096999999999994,
                    0.056096999999999994,
                ],
            ]
        )
        # print("expected = np.array(" + repr(states.tolist()) + ")")

        assert np.allclose(states, test_states, rtol=1e-4)


if __name__ == "__main__":
    tss = TestSwarmSim()
    tss.test_create_swarmsim()
